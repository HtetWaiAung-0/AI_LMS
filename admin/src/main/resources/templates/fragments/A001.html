<!DOCTYPE html>
<html lang="en" th:replace="~{layouts/main :: layout(~{::main})}" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Title</title>
  <style>
    .chartBox {
      width: 600px;
      padding: 20px;
      border-radius: 20px;
    }
  </style>
</head>

<body>
  <main role="main">
    <div th:fragment="admin-home">
      <div class="semi-circle"></div>
      <div class="d-flex flex-column">
        <div class="cards form-group custom-div1">
          <!-- <a href="admin-student-page.html" class="unit-a">
              <div class="card-single cs2">
                <div>
                  <h1>Student</h1>
                </div>
                <div class="card-link">
                  <i class="fa-solid fa-graduation-cap"></i>
                  <span id="num">13</span>
                  <a href="" class="btn btn-floating" data-mdb-ripple-color="dark">
                    <i class="fa-solid fa-circle-plus" id="add"></i>
                  </a>
                </div>
              </div>
            </a> -->
          <a href="/templates/A002.html" class="unit-a">
            <div class="card-single cs3">
              <div>
                <h1>Course</h1>
              </div>
              <div class="card-link">
                <i class="fa-solid fa-book"></i>
                <span id="num" th:text="${courseCount}"></span>
              </div>
            </div>
          </a>
          <a href="/templates/A003.html" class="unit-a">
            <div class="card-single cs4">
              <div>
                <h1>Batch</h1>
              </div>
              <div class="card-link">
                <i class="fa-solid fa-person-chalkboard"></i>
                <span id="num" th:text="${courseCount}"></span>
              </div>
            </div>
          </a>
          <a href="/templates/A004.html" class="unit-a">
            <div class="card-single cs1">
              <div>
                <h1>Teacher</h1>
              </div>
              <div class="card-link">
                <i class="fa-solid fa-people-group"></i>
                <span id="num" th:text="${teacherCount}"></span>
              </div>
            </div>
          </a>
        </div>

        <!-- <div class="interface"></div>   -->

        <div class="charts custom-div d-flex flex-column">
          <div>
            <select name="" id="batch">
              <option th:each="batch : ${batchList}" th:value="${batch.id}" th:text="${batch.name}"></option>
            </select>
          </div>
          <div id="graficoSituacoesPedidos" class="chartBox">
            <canvas id="myChart"></canvas>
          </div>
        </div>
      </div>

      <div id="footer"></div>

      <script th:src="@{/assets/jquery/jquery.min.js}"></script>
      <script src="https://kit.fontawesome.com/83e4876698.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      </script>


      <script type="text/javascript">
        $(document).ready(function () {
          let batchId = document.getElementById("batch").value;
          var studentName = [];
          var attendence = [];
          document.getElementById("batch").addEventListener("change", () => {

            let target = document.getElementById("batch").value;
            studentName = []
            attendence = []
            $('#myChart').remove();
            $('#graficoSituacoesPedidos').append('<canvas id="myChart" ></canvas>');
            $.ajax({
              url: "/admin/grap?batchId=" + target,
              success: function (result) {
                var batchId = [studentName, attendence, batchId];
                console.log(result);
                result.forEach((element) => {
                  studentName.push(element.stuName);
                  attendence.push(element.attendance);
                });
              }
            });
            var chartdata = {
              labels: studentName,
              datasets: [
                {
                  label: 'Attend Count Per Student Data',
                  backgroundColor: 'rgba(255, 99, 132, 0.6)',
                  borderColor: 'rgba(200, 200, 200, 0.75)',
                  hoverBackgroundColor: 'rgba(255, 99, 132, 1)',
                  hoverBorderColor: 'rgba(200, 200, 200, 1)',
                  data: attendence
                }
              ]
            };

            var ctx = $("#myChart");

            var barGraph = new Chart(ctx, {
              type: 'bar',
              data: chartdata
            });


          });

          // setTimeout(() => {
            $.ajax({
              url: "/admin/grap?batchId=" + batchId,
              success: function (result) {
                var batchId = [studentName, attendence, batchId];
                result.forEach((element) => {
                  studentName.push(element.stuName);
                  attendence.push(element.attendance);
                });
              },
            });
            var chartdata = {
              labels: studentName,
              datasets: [
                {
                  label: 'Attend Count Per Student Data',
                  backgroundColor: 'rgba(255, 99, 132, 0.6)',
                  borderColor: 'rgba(200, 200, 200, 0.75)',
                  hoverBackgroundColor: 'rgba(255, 99, 132, 1)',
                  hoverBorderColor: 'rgba(200, 200, 200, 1)',
                  data: attendence
                }
              ]
            };

            var ctx = $("#myChart");

            var barGraph = new Chart(ctx, {
              type: 'bar',
              data: chartdata
            });


          // }, 100);

        });
      </script>


      <!-- <script>
        $(document).ready(function () {
          
          
            var ctx = $("#myChart");
            var batchId = document.getElementById("batch").value;
            console.log(batchId);
            $.ajax({
              url: "/admin/grap?batchId=" + dd,
              method: "GET",
              success: function (result) {

                result.forEach((element) => {
                  studentName.push(element.stuName);
                  attendence.push(element.attendance);
                });
              }
            });
            var chartdata = {
              labels: studentName,
              datasets: [
                {
                  label: 'Attend Count Per Student Data',
                  backgroundColor: 'rgba(255, 99, 132, 0.6)',
                  borderColor: 'rgba(200, 200, 200, 0.75)',
                  hoverBackgroundColor: 'rgba(255, 99, 132, 1)',
                  hoverBorderColor: 'rgba(200, 200, 200, 1)',
                  data: attendence
                }
              ]
            };
            if (barGraph !== undefined) {
              barGraph.clear();
              barGraph.destroy();
            }
            var barGraph = new Chart(ctx, {
              type: 'bar',
              data: chartdata
            });
            barGraph.update();
          
          // let batchId = document.getElementById("batch").value;
          // var studentName = [];
          // var attendence = [];
          // $.ajax({
          //   url: "/admin/grap?batchId=" + batchId,
          //   method: "GET",
          //   success: function (result) {

          //     result.forEach((element) => {
          //       studentName.push(element.stuName);
          //       attendence.push(element.attendance);
          //     });

          //     var chartdata = {
          //       labels: studentName,
          //       datasets: [
          //         {
          //           label: 'Attend Count Per Student Data',
          //           backgroundColor: 'rgba(255, 99, 132, 0.6)',
          //           borderColor: 'rgba(200, 200, 200, 0.75)',
          //           hoverBackgroundColor: 'rgba(255, 99, 132, 1)',
          //           hoverBorderColor: 'rgba(200, 200, 200, 1)',
          //           data: attendence
          //         }
          //       ]
          //     };

          //     var ctx = $("#myChart");

          //     var barGraph = new Chart(ctx, {
          //       type: 'bar',
          //       data: chartdata
          //     });
          //   },
          //   error: function (result) {
          //     console.log(result);
          //   }
          // });
        });
      </script> -->

    </div>
  </main>
</body>

</html>