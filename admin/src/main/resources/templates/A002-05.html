<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ace Inspiration Exam Add</title>
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
      integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="../assets/css/header.css" />
  </head>
  <body>
    <div id="header"></div>
    <div class="semi-circle"></div>
    <div class="banner">
      <div class="circle">
        <i class="fa-regular fa-folder-open"></i>
      </div>
      <div>
        <h1>Exam</h1>
        <h3>Course</h3>
      </div>
    </div>
    <div class="custom-div margin-top-8">
      <div class="container">
        <!-- <div class="course-title text-center">
                    <h3>Course Name</h3>
                </div> -->
        <div class="exam-form rounded">
          <form action="#" method="post" id="exam">
            <div class="exam-header p-3" id="exam-header">
              <div class="container">
                <div class="row">
                  <div class="col-6 text-secondary">
                    <span>
                        <input type="text" class="form-control" name="course-id" placeholder = "courseId with hidden input" value="1">
                    </span>
                  </div>
                  
                  <div class="col-6">
                    <button
                    type="submit"
                      class="float-end btn  btn-outline-primary"
                      style="font-size: 1em"
                      id="add_exam"
                    >
                      <i class="fa-solid fa-folder-plus me-1"></i>
                      <span style="font-size: 15px;">
                        Upload Exam
                      </span> 
                    </button>
                  </div>
                </div>
                <div class="row">
                  <div class="col-4 text-secondary" >Exam Name</div>
                  <div class="col-4 text-secondary">Exam Type</div>
                  <div class="col-4 text-secondary">Duration</div>
                </div>
                <div class="row mt-1 d-flex">
                  <div class="col-4">
                    <input
                      type="text"
                      maxlength="50"
                      class="form-control"
                      name="name"
                      required
                      placeholder="Exam Name"
                    />
                  </div>
                  <div class="col-4">
                    <div class="form-check form-check-inline">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="answer-type"
                        value="Multiple Choice"
                        id="answer-radio"
                        checked
                      />
                      <label class="form-check-label" for="answer-radio">
                        Multiple Choice
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="answer-type"
                        id="answer-other"
                        value="File Upload"
                      />
                      <label class="form-check-label" for="answer-other">
                        File Upload
                      </label>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="row">
                      <div class="col-md-6 col-sm-12 d-flex">
                        <input
                          type="number"
                          min="0"
                          max="128"
                          value="00"
                          name="hour"
                          placeholder="Hour"
                          class="form-control me-2"
                          style="width: 60px; height: 30px"                        
                          
                        />
                        <label class="text-secondary">Hour</label>
                      </div>
                      <div class="col-md-6 col-sm-12 d-flex">
                        <input
                          type="number"
                          name="minute"
                          min="0"
                          max="59"
                          class="form-control me-2"
                          style="width: 60px; height: 30px"                                                   
                          value="00"
                        />
                        <label class="text-secondary">Minutes</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- End exam header-->

            <!-- Exam Content-->
            <div class="exam-content p-4 rounded" id="exam-content">
              <!--Mutliple Choice-->
              <ol class="list-group">
                <li
                  class="m-choice card-body shadow rounded p-4"
                  id="m-choice"
                >
                <input type="hidden" id="question-id"  value="0">
                  <div class="row">
                    <div class="col-8 mr-auto">
                      <textarea                        
                        name="mc-question"
                        class="col-10 form-control question border-none"
                        id="question"
                        rows="1"
                        maxlength="500"
                        placeholder="Your question..."
                        required
                      ></textarea>
                    </div>
                    <div class="col-2">
                      <input
                        type="number"
                        name="point"
                        class="point form-control me-2"
                        style="width: 60px; height: 30px"
                        id="point"
                        min="1"
                        value="1"
                      /><label class="text-secondary">Points</label>
                    </div>
                    <div class="col-2 ">
                      <button
                        type="button"
                        class="btn rounded-circle question-add text-primary"
                        style="box-shadow: none"
                      >
                        <i class="fa-solid fa-plus"></i>
                      </button>
                      <button  type="button" class=" question-remove btn rounded-circle  text-danger" style="box-shadow: none;"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                  </div>
  
                  <div class="row mt-1 option-added" id="mc-option">
                    <div class="col-8">
                      <input type="radio" name="correct-ans0" checked class="me-2" />
                      <label
                        ><input
                          type="text"
                          id="option-input"
                          name="option"
                          maxlength="100"
                          class="form-control"
                          placeholder="Option"
                          required                         
                      /></label>
                    </div>
                    <div class="col-4">
                      <button
                        type="button"
                        style="box-shadow: none"
                        class="btn rounded-circle option-plus text-secondary"
                      >
                        <i class="fa-solid fa-plus"></i>
                      </button>
                      <button type="button" class="btn option-delete rounded-circle  text-danger" style="box-shadow: none;" ><i class="fa-solid fa-delete-left"></i></button>
                    </div>
                  </div>
                </li>

              </ol>
              <!-- End Multiple choice question-->

              <!-- Other Question -->
              <div
                class="exam-other shadow rounded p-4"
                id="exam-other"
              >
                <ol class="list-group">                  
                  <li class="card-body">
                    <div class="row  other-question">
                      <div class="col-8 mr-auto">
                        <textarea
                          id="textarea-other-question"
                          name="other-question"
                          class="col-10 form-control question border-none"
                          rows="1"
                          placeholder="Your question..."
                          maxlength="500"
                          required
                        ></textarea>
                      </div>
                      <div class="col-2">
                        <input
                          type="number"
                          name="point"
                          class="form-control me-2 "
                          style="width: 70px; height: 30px"
                          id="point"
                          min="1"
                          value="1"
                        /><label class="text-secondary">Points</label>
                      </div>
                      <div class="col-1 d-flex">
                        <button
                          type="button"
                          class="btn btn-other-question-add rounded-circle text-primary"
                          style="box-shadow: none"
                        >
                          <i class="fa-solid fa-plus"></i>
                        </button>
                        
                        <button
                        type="button"
                        class="btn  other-question-delete rounded-circle text-danger"
                        style="box-shadow: none"
                      >
                        <i class="fa-solid fa-trash-can"></i>
                      </button>
                      </div>
                    </div>
                  </li>
                </ol>
               
              </div>
              <!-- End other question -->
            </div>
            <!-- Edn exam content-->
          </form>
        </div>
        <!--End Exam form div-->
      </div>
      <!-- End container-->
    </div>
    <script src="../assets/jquery/jquery.min.js"></script>
    <script
      src="https://kit.fontawesome.com/83e4876698.js"
      crossorigin="anonymous"
    ></script>
    <!-- <script>
        $(function(e){           
            $("#header").load("./A006.html");
        })
    </script> -->
    <script>
      $(document).ready(function () {
       
        let total_point = 0;
        var question_count_radio = 1;
        var radio_question_id = 1;

        function disabled_exam_other(){
          $("#exam-other").hide();
          $('#exam-other input').attr("disabled", true);
          $('#exam-other textarea').attr("disabled", true);
        }
        function enable_exam_other(){
          $("#exam-other").show();
          $('#exam-other input').removeAttr("disabled");
          $('#exam-other textarea').removeAttr("disabled");
        }
        function disabled_radio_exam(){
          $(".m-choice").hide();
          $('.m-choice input').attr("disabled", true);
          $('.m-choice textarea').attr("disabled", true);
        }
        function enable_radio_exam(){
          $(".m-choice").show();
          $('.m-choice input').removeAttr("disabled");
          $('.m-choice textarea').removeAttr("disabled");
        }


        //For radio button checked       
        disabled_exam_other();
        enable_radio_exam();
        $("#answer-radio").on("click", function () {
          disabled_exam_other();
          enable_radio_exam();          
        });

        //For other button checked
        $("#answer-other").on("click", function () {
          disabled_radio_exam();
          enable_exam_other();
        });                

      //add Option
      $(document).on("click", ".option-plus", function () {
        var question_id = $(this).closest('.m-choice').find('#question-id').val();
        var div_row =
                    `<div class="row mt-1 option-added">
                      <div class="col-8">
                        <input type="radio" name="correct-ans`+question_id+`" class="me-2"><label><input type="text" id="option-input" maxlength="100" name="option" class="form-control" placeholder="Option 1" required ></label>
                      </div>
                      <div class="col-4">
                        <button type="button" class="btn option-plus rounded-circle  text-secondary" style="box-shadow: none;" ><i class="fa-solid fa-plus"></i></button>
                        <button type="button" class="btn option-delete rounded-circle  text-danger" style="box-shadow: none;" ><i class="fa-solid fa-delete-left"></i></button>
                    </div>
                    </div>`;
        let count = $(this).closest(".m-choice").find(".option-added").length;
        if (count < 5 )
        $(this).closest(".option-added").after(div_row);
      });

      //Add Mutliple Choice Question
      $(document).on("click", ".question-add", function () {
        var question = $('.m-choice textarea[name="mc-question"]').val();
        var _radio_question = ` <li class="m-choice card-body shadow rounded mt-2 p-4" id="m-choice">
                                    <input type="hidden" id="question-id"  value="`+radio_question_id+`">
                                  <div class="row">
                                        <div class="col-8 mr-auto">
                                            <textarea maxlength="500" name="mc-question" class="col-10 form-control question border-none"  rows="1" placeholder="Your question..." required></textarea>
                                        </div>                                                    
                                        <div class="col-2">
                                            <input type="number" name="point" class="form-control me-2 " style="width: 60px; height: 30px" min="1" value="1"><label class="text-secondary">Points</label>
                                        </div> 
                                        <div class="col-2  ">
                                            <button type="button" class=" question-add btn rounded-circle  text-primary" style="box-shadow: none;"><i class="fa-solid fa-plus"></i></button>
                                            <button type="button" class=" question-remove btn rounded-circle  text-danger" style="box-shadow: none;"><i class="fa-solid fa-trash-can"></i></button>
                                        </div>                                  
                                    </div>                                
                                    <div class="row mt-1 option-added" >
                                        <div class="col-8">
                                            <input type="radio" name="correct-ans`+radio_question_id+`" checked class="me-2"><label><input type="text" id="option-input" name="option" class="form-control" placeholder="Option" maxlength="100" required></label>
                                        </div>
                                        <div class="col-4">                             
                                            <button type="button" style="box-shadow: none;" class="btn rounded-circle option-plus text-secondary" ><i class="fa-solid fa-plus"></i></button>
                                            <button type="button" class="btn option-delete rounded-circle  text-danger" style="box-shadow: none;" ><i class="fa-solid fa-delete-left"></i></button>
                                        </div>
                                    </div>
                                </li>`;
        
        $(this).closest('#m-choice').after(_radio_question);       
        question_count_radio++;
        radio_question_id++;
      });

      //Remove Question
      $(document).on("click", ".question-remove", function () {
        var question_row = $(this).closest(".m-choice");
        let count = question_row.parent().find(".m-choice").length;
        if (count > 1){
          question_row.remove();
          question_count_radio--;

        }
        
      });
      //Remove Option
      $(document).on("click", ".btn.option-delete", function () {
        var div_row = $(this).closest(".row");
        let count = $(this).closest(".m-choice").find(".option-added").length;
        if(count > 1)
        div_row.remove();
      });
    

    });//This is end of docuemnt.ready
    </script>

    <script>
      //Add other question
      $(document).on("click",".btn-other-question-add ",function () {
        var _row =`
              <li class="card-body">
                <div class="row  other-question mt-2">
                    <div class="col-8 mr-auto">
                        <textarea
                        id="textarea-other-question"
                        name="other-question"
                        class="col-10 form-control question border-none"
                        rows="1"
                        placeholder="Your question..."
                        maxlength="500"
                        required
                        ></textarea>
                    </div>
                    <div class="col-2">
                        <input
                        type="number"
                        name="point"
                        class="form-control me-2"
                        style="width: 70px; height: 30px"
                        id="point"
                        min="1"
                        value="1"
                        /><label class="text-secondary">Points</label>
                    </div>
                    <div class="col-1 d-flex">
                        <button
                        class="btn btn-other-question-add  rounded-circle text-primary"
                        style="box-shadow: none"
                        type="button"
                        >
                        <i class="fa-solid fa-plus"></i>
                        </button>
                        <button
                        type="button"
                        class="btn rounded-circle text-danger other-question-delete"
                        style="box-shadow: none"
                        >
                        <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </div>
                </div> 
              </li>`
        $(this).closest('li').after(_row);
        
      });  

      //Other Question delete
      $(document).on("click", ".other-question-delete", function () {
        let count = $(this).closest("li").parent().find(".row").length;
        if(count > 1)
        $(this.closest("li").remove());
      });
    </script>

    <script>
      $("#exam").submit(function(e){ 
          e.preventDefault(); 
          let exam = {}
          let course_id = $('input[name="course-id"]').val();
          let name = $('input[name="name"]').val();
          let hour = $('input[name="hour"]').val();
          let minute = $('input[name="minute"]').val();          
          //let duration = {"hour": hour, "minute" : minute}
          let duration = hour+":"+minute;
          let type = $('input[name="answer-type"]:checked').val();
          let total_point = 0;
          let questions = [];

          if (type === 'Multiple Choice'){
            let multiple_choice_questions = $('#exam-content').find('.m-choice');
            //Loop Multiple choice questions
            $(multiple_choice_questions).each(function(){
                let question = {} //One Question
                let point = $(this).find('input[name="point"]').val();
                total_point += parseInt(point);
                let text = $(this).find('textarea').val();
                let answer_list = [];
                let answer_loop = $(this).find('.option-added');
                let correct_answer = $(answer_loop).find('input[type="radio"]:checked + label input').val();              
                $(answer_loop).each(function(){
                  let answer = $(this).find('input[name="option"]').val();
                  answer_list.push(answer)
                });// End answer loop              
                question["text"] = text;
                question["point"] = point;
                question["answer_list"] = answer_list;
                question["correct_answer"] = correct_answer;
                questions.push(question);
                
            }); //End all multiple choice questions loop
          }
          else{ //For file upload question
            let fileupload_question_loop = $('#exam-content').find('.other-question');
            $(fileupload_question_loop).each(function(){
              let question = {};
              let point  = $(this).find('input[name="point"]').val();              
              let text = $(this).find('textarea[name="other-question"]').val();
              total_point += parseInt(point);
              question["text"] = text;
              question["point"]  = point;
              questions.push(question);
            })
          }
         
          exam["course_id"] = course_id;
          exam["name"] = name;
          exam["duration"] = duration;
          exam["type"]  = type;
          exam["total_point"] = total_point;
          exam["questions"] = questions;

          console.log(exam);

          $.ajax({
            type : "POST",
            url : "saveExam",
            headers : {
                "Content-Type" : "application/json"
            },
            data: JSON.stringify(exam),
            success : function(){
                alert("Exam save successfully");
            }
          })

      })
    </script>
   
  </body>
</html>
